openapi: 3.0.0
paths:
  /:
    get:
      operationId: AppController_getHello
      parameters: []
      responses:
        '200':
          description: Возвращает приветственное сообщение
      summary: Корневой эндпоинт
      tags:
        - System
  /health:
    get:
      operationId: AppController_getHealth
      parameters: []
      responses:
        '200':
          description: Статус здоровья сервиса
          content:
            application/json:
              schema:
                example:
                  status: ok
                  timestamp: '2024-01-01T00:00:00.000Z'
                  uptime: 123.456
                  environment: production
                  version: 0.0.1
                  checks:
                    database:
                      status: healthy
                      responseTime: 5ms
                  responseTime: 10ms
      summary: Проверка здоровья сервиса
      tags:
        - System
  /auth/client/telegram:
    post:
      operationId: AuthController_clientTelegramLogin
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TelegramLoginDto'
      responses:
        '200':
          description: Успешная аутентификация клиента через Telegram
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClientAuthResponseDto'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorDto'
      summary: Авторизация клиента через Telegram Web App
      tags:
        - Auth
  /auth/admin/login:
    post:
      operationId: AuthController_adminLogin
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminLoginDto'
      responses:
        '200':
          description: Успешная аутентификация администратора
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminAuthResponseDto'
        '401':
          description: Неверные учетные данные
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorDto'
      summary: Авторизация администратора через email и пароль
      tags:
        - Auth
  /auth/refresh:
    post:
      operationId: AuthController_refreshToken
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RefreshTokenDto'
      responses:
        '200':
          description: Новые токены
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefreshTokenResponseDto'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorDto'
      summary: Обновление accessToken используя refreshToken (с ротацией)
      tags:
        - Auth
  /auth/logout:
    post:
      operationId: AuthController_logout
      parameters: []
      responses:
        '204':
          description: Logged out
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorDto'
      security:
        - bearer: []
      summary: Выход из системы (удаление refresh token)
      tags:
        - Auth
  /auth/me:
    get:
      operationId: AuthController_getMe
      parameters: []
      responses:
        '200':
          description: Информация о пользователе
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MeResponseDto'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorDto'
      security:
        - bearer: []
      summary: Получить информацию о текущем пользователе
      tags:
        - Auth
  /clients:
    get:
      operationId: ClientsController_findAll
      parameters:
        - name: cursor
          required: false
          in: query
          description: Курсор для пагинации
          schema:
            example: cm4a2b3c4d5e6f7g8h9i0j
            type: string
        - name: limit
          required: false
          in: query
          description: Количество элементов на странице
          schema:
            minimum: 1
            maximum: 200
            default: 20
            example: 20
            type: number
      responses:
        '200':
          description: Список клиентов
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponseDto'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
      security:
        - bearer: []
        - adminAuth: []
      summary: Список всех клиентов
      tags:
        - Clients
  /clients/me:
    get:
      operationId: ClientsController_getMe
      parameters: []
      responses:
        '200':
          description: Профиль клиента
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClientDto'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden - только клиенты могут использовать этот эндпоинт
      security:
        - bearer: []
      summary: Получить профиль текущего клиента
      tags:
        - Clients
    patch:
      operationId: ClientsController_updateMe
      parameters: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                phone:
                  type: string
                  nullable: true
                firstName:
                  type: string
                  nullable: true
                lastName:
                  type: string
                  nullable: true
                dateOfBirth:
                  type: string
                  format: date-time
                  nullable: true
                  description: Дата рождения в формате ISO 8601
                photo:
                  type: string
                  format: binary
                  nullable: true
                  description: Фото профиля (макс. 10МБ)
                deletePhoto:
                  type: boolean
                  nullable: true
                  description: Установите true для удаления существующего фото. Игнорируется, если загружен файл фото.
          application/json:
            schema:
              type: object
              properties:
                phone:
                  type: string
                  nullable: true
                firstName:
                  type: string
                  nullable: true
                lastName:
                  type: string
                  nullable: true
                dateOfBirth:
                  type: string
                  format: date-time
                  nullable: true
                  description: Дата рождения в формате ISO 8601
                photo:
                  type: string
                  format: binary
                  nullable: true
                  description: Фото профиля (макс. 10МБ)
                deletePhoto:
                  type: boolean
                  nullable: true
                  description: Установите true для удаления существующего фото. Игнорируется, если загружен файл фото.
      responses:
        '200':
          description: Обновлено
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClientDto'
        '400':
          description: Неверный запрос (например, файл слишком большой)
        '401':
          description: Unauthorized
        '403':
          description: Forbidden - только клиенты могут использовать этот эндпоинт
      security:
        - bearer: []
      summary: Обновить профиль текущего клиента
      tags:
        - Clients
  /clients/me/cashback:
    get:
      operationId: ClientsController_getMyCashback
      parameters: []
      responses:
        '200':
          description: Кэшбэк-кошелек с балансом и историей
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CashbackWalletDto'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden - только клиенты могут использовать этот эндпоинт
      security:
        - bearer: []
      summary: Получить кэшбэк-кошелек текущего клиента
      tags:
        - Clients
  /clients/{id}:
    get:
      operationId: ClientsController_findOne
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Клиент
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClientDto'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not Found
      security:
        - bearer: []
      summary: Получить клиента по ID
      tags:
        - Clients
    patch:
      operationId: ClientsController_update
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                phone:
                  type: string
                  nullable: true
                firstName:
                  type: string
                  nullable: true
                lastName:
                  type: string
                  nullable: true
                dateOfBirth:
                  type: string
                  format: date-time
                  nullable: true
                  description: Дата рождения в формате ISO 8601
                photo:
                  type: string
                  format: binary
                  nullable: true
                  description: Фото профиля (макс. 10МБ)
                deletePhoto:
                  type: boolean
                  nullable: true
                  description: Установите true для удаления существующего фото. Игнорируется, если загружен файл фото.
          application/json:
            schema:
              type: object
              properties:
                phone:
                  type: string
                  nullable: true
                firstName:
                  type: string
                  nullable: true
                lastName:
                  type: string
                  nullable: true
                dateOfBirth:
                  type: string
                  format: date-time
                  nullable: true
                  description: Дата рождения в формате ISO 8601
                photo:
                  type: string
                  format: binary
                  nullable: true
                  description: Фото профиля (макс. 10МБ)
                deletePhoto:
                  type: boolean
                  nullable: true
                  description: Установите true для удаления существующего фото. Игнорируется, если загружен файл фото.
      responses:
        '200':
          description: Обновлено
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClientDto'
        '400':
          description: Неверный запрос (например, файл слишком большой)
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not Found
      security:
        - bearer: []
        - adminAuth: []
      summary: Обновить профиль клиента
      tags:
        - Clients
  /clients/me/complete-profile:
    post:
      description: >-
        Используется для завершения заполнения профиля при первом входе пользователя. Требуется указать полное имя,
        телефон и все обязательные согласия.
      operationId: ClientsController_completeProfile
      parameters:
        - name: user-agent
          required: true
          in: header
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CompleteProfileDto'
      responses:
        '200':
          description: Профиль успешно заполнен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClientDto'
        '400':
          description: Неверный запрос - ошибка валидации или отсутствуют обязательные согласия
        '401':
          description: Unauthorized
        '403':
          description: Forbidden - только клиенты могут использовать этот эндпоинт
        '404':
          description: Клиент не найден
      security:
        - bearer: []
      summary: Завершить заполнение профиля клиента при первом входе
      tags:
        - Clients
  /users/{id}/cashback:
    get:
      operationId: UserCashbackController_getCashback
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CashbackWalletDto'
      security:
        - bearer: []
      summary: Баланс кэшбэка пользователя (self или ADMIN)
      tags:
        - Users
        - Cashback
  /users/{id}/cashback/operations:
    get:
      operationId: UserCashbackController_findUserOperations
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: cursor
          required: false
          in: query
          description: Курсор для пагинации. Передайте значение из поля "next" предыдущего ответа.
          schema:
            example: cm4a2b3c4d5e6f7g8h9i0j
            type: string
        - name: limit
          required: false
          in: query
          description: Количество элементов на странице
          schema:
            minimum: 1
            maximum: 200
            default: 20
            example: 20
            type: number
      responses:
        '200':
          description: История операций
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponseDto'
      security:
        - bearer: []
      summary: История операций кэшбэка пользователя
      tags:
        - Users
        - Cashback
  /cashback/rules:
    get:
      operationId: CashbackController_getRules
      parameters: []
      responses:
        '200':
          description: Правила кэшбэка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CashbackRulesDto'
      summary: Получить правила кэшбэка (только чтение)
      tags:
        - Cashback
  /cashback/settings:
    get:
      operationId: CashbackController_getSettings
      parameters: []
      responses:
        '200':
          description: Список настроек кэшбэка
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/CashbackSettingsDto'
      security:
        - adminAuth: []
        - bearer: []
      summary: Получить все настройки кэшбэка
      tags:
        - Cashback
  /cashback/settings/{product}:
    put:
      operationId: CashbackController_updateSettings
      parameters:
        - name: product
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCashbackSettingsDto'
      responses:
        '200':
          description: Обновленные настройки кэшбэка
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CashbackSettingsDto'
      security:
        - adminAuth: []
        - bearer: []
      summary: Обновить настройки кэшбэка для продукта
      tags:
        - Cashback
  /admins:
    get:
      operationId: AdminsController_findAll
      parameters:
        - name: cursor
          required: false
          in: query
          description: Курсор для пагинации
          schema:
            example: cm4a2b3c4d5e6f7g8h9i0j
            type: string
        - name: limit
          required: false
          in: query
          description: Количество элементов на странице
          schema:
            minimum: 1
            maximum: 200
            default: 20
            example: 20
            type: number
      responses:
        '200':
          description: Список администраторов
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponseDto'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
      security:
        - adminAuth: []
        - bearer: []
      summary: Список всех администраторов
      tags:
        - Admins
    post:
      operationId: AdminsController_create
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAdminDto'
      responses:
        '201':
          description: Администратор создан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminDto'
        '400':
          description: Bad Request
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '409':
          description: Администратор с таким email уже существует
      security:
        - adminAuth: []
        - bearer: []
      summary: Создать нового администратора
      tags:
        - Admins
  /admins/me:
    get:
      operationId: AdminsController_getMe
      parameters: []
      responses:
        '200':
          description: Профиль администратора
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminDto'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
      security:
        - adminAuth: []
        - bearer: []
      summary: Получить профиль текущего администратора
      tags:
        - Admins
    patch:
      operationId: AdminsController_updateMe
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AdminUpdateDto'
      responses:
        '200':
          description: Обновлено
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminDto'
        '400':
          description: Bad Request
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
      security:
        - adminAuth: []
        - bearer: []
      summary: Обновить профиль текущего администратора
      tags:
        - Admins
  /admins/{id}:
    get:
      operationId: AdminsController_findOne
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Администратор
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminDto'
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Not Found
      security:
        - adminAuth: []
        - bearer: []
      summary: Получить администратора по ID
      tags:
        - Admins
  /admins/me/password:
    patch:
      operationId: AdminsController_changePassword
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ChangePasswordDto'
      responses:
        '200':
          description: Пароль успешно изменен
        '400':
          description: Неверный запрос (например, неправильный текущий пароль)
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
      security:
        - adminAuth: []
        - bearer: []
      summary: Изменить пароль текущего администратора
      tags:
        - Admins
  /events:
    get:
      operationId: EventsController_findAll
      parameters:
        - name: q
          required: false
          in: query
          description: Search by title/description
          schema:
            type: string
        - name: cursor
          required: false
          in: query
          description: Cursor for pagination. Pass the value from the "next" field of the previous response.
          schema:
            type: string
        - name: limit
          required: false
          in: query
          schema:
            minimum: 1
            maximum: 200
            default: 20
            type: number
        - name: startsAfter
          required: false
          in: query
          description: Return entities starting AFTER this moment (RFC3339)
          schema:
            format: date-time
            type: string
        - name: endsBefore
          required: false
          in: query
          description: Return entities starting BEFORE this moment (RFC3339)
          schema:
            format: date-time
            type: string
        - name: labels.any
          required: false
          in: query
          description: Match ANY of the specified labels (OR)
          schema:
            type: array
            items:
              type: string
        - name: labels.all
          required: false
          in: query
          description: Match ALL of the specified labels (AND)
          schema:
            type: array
            items:
              type: string
        - name: labels.none
          required: false
          in: query
          description: Exclude events with any of these labels (NOT)
          schema:
            type: array
            items:
              type: string
        - name: attr.eq
          required: false
          in: query
          description: Equality filter by attribute keys
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.in
          required: false
          in: query
          description: In set filter by attribute keys
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.gte
          required: false
          in: query
          description: Greater than or equal filter for numeric attributes
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.lte
          required: false
          in: query
          description: Less than or equal filter for numeric attributes
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.bool
          required: false
          in: query
          description: Boolean attribute filter
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.exists
          required: false
          in: query
          description: Check attribute key existence
          schema:
            $ref: '#/components/schemas/Object'
      responses:
        '200':
          description: Список событий
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponseDto'
      summary: Каталог событий
      tags:
        - Events
    post:
      operationId: EventsController_create
      parameters: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                title:
                  type: string
                description:
                  type: array
                  items:
                    type: object
                    properties:
                      heading:
                        type: string
                      body:
                        type: string
                  nullable: true
                location:
                  type: string
                  nullable: true
                capacity:
                  type: integer
                  minimum: 0
                  nullable: true
                tickets:
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                      prepayment:
                        type: object
                        properties:
                          price:
                            type: object
                            properties:
                              currency:
                                type: string
                              amountMinor:
                                type: integer
                          description:
                            type: string
                            nullable: true
                      full:
                        type: object
                        properties:
                          price:
                            type: object
                            properties:
                              currency:
                                type: string
                              amountMinor:
                                type: integer
                          description:
                            type: string
                            nullable: true
                labels:
                  type: array
                  items:
                    type: string
                  nullable: true
                attributes:
                  type: object
                  additionalProperties: true
                  nullable: true
                images:
                  type: array
                  items:
                    type: string
                    format: binary
                  description: Файлы изображений (макс. 10 файлов, 10МБ каждый)
                  nullable: true
              required:
                - title
                - tickets
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                description:
                  type: array
                  items:
                    type: object
                    properties:
                      heading:
                        type: string
                      body:
                        type: string
                  nullable: true
                location:
                  type: string
                  nullable: true
                capacity:
                  type: integer
                  minimum: 0
                  nullable: true
                tickets:
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                      prepayment:
                        type: object
                        properties:
                          price:
                            type: object
                            properties:
                              currency:
                                type: string
                              amountMinor:
                                type: integer
                          description:
                            type: string
                            nullable: true
                      full:
                        type: object
                        properties:
                          price:
                            type: object
                            properties:
                              currency:
                                type: string
                              amountMinor:
                                type: integer
                          description:
                            type: string
                            nullable: true
                labels:
                  type: array
                  items:
                    type: string
                  nullable: true
                attributes:
                  type: object
                  additionalProperties: true
                  nullable: true
                images:
                  type: array
                  items:
                    type: string
                    format: binary
                  description: Файлы изображений (макс. 10 файлов, 10МБ каждый)
                  nullable: true
              required:
                - title
                - tickets
      responses:
        '201':
          description: Создано
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EventDto'
      security:
        - adminAuth: []
        - bearer: []
      summary: Создать событие (ADMIN)
      tags:
        - Events
  /events/{id}:
    get:
      operationId: EventsController_findOne
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Событие
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EventDto'
      summary: Получить событие по ID
      tags:
        - Events
    patch:
      operationId: EventsController_update
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                title:
                  type: string
                  nullable: true
                description:
                  type: array
                  items:
                    type: object
                    properties:
                      heading:
                        type: string
                      body:
                        type: string
                  nullable: true
                location:
                  type: string
                  nullable: true
                capacity:
                  type: integer
                  minimum: 0
                  nullable: true
                tickets:
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                      prepayment:
                        type: object
                        properties:
                          price:
                            type: object
                            properties:
                              currency:
                                type: string
                              amountMinor:
                                type: integer
                          description:
                            type: string
                            nullable: true
                      full:
                        type: object
                        properties:
                          price:
                            type: object
                            properties:
                              currency:
                                type: string
                              amountMinor:
                                type: integer
                          description:
                            type: string
                            nullable: true
                  nullable: true
                labels:
                  type: array
                  items:
                    type: string
                  nullable: true
                attributes:
                  type: object
                  additionalProperties: true
                  nullable: true
                images:
                  type: array
                  items:
                    type: string
                    format: binary
                  description: Новые файлы изображений для добавления (макс. 10 файлов, 10МБ каждый)
                  nullable: true
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  nullable: true
                description:
                  type: array
                  items:
                    type: object
                    properties:
                      heading:
                        type: string
                      body:
                        type: string
                  nullable: true
                location:
                  type: string
                  nullable: true
                capacity:
                  type: integer
                  minimum: 0
                  nullable: true
                tickets:
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                      prepayment:
                        type: object
                        properties:
                          price:
                            type: object
                            properties:
                              currency:
                                type: string
                              amountMinor:
                                type: integer
                          description:
                            type: string
                            nullable: true
                      full:
                        type: object
                        properties:
                          price:
                            type: object
                            properties:
                              currency:
                                type: string
                              amountMinor:
                                type: integer
                          description:
                            type: string
                            nullable: true
                  nullable: true
                labels:
                  type: array
                  items:
                    type: string
                  nullable: true
                attributes:
                  type: object
                  additionalProperties: true
                  nullable: true
                images:
                  type: array
                  items:
                    type: string
                    format: binary
                  description: Новые файлы изображений для добавления (макс. 10 файлов, 10МБ каждый)
                  nullable: true
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EventDto'
      security:
        - adminAuth: []
        - bearer: []
      summary: Обновить событие (ADMIN)
      tags:
        - Events
    delete:
      description: Удаляет событие. По умолчанию не позволяет удалить событие, если у него есть сессии с активными бронированиями.
      operationId: EventsController_delete
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: force
          required: true
          in: query
          schema:
            type: boolean
      responses:
        '204':
          description: Событие успешно удалено
      security:
        - adminAuth: []
        - bearer: []
      summary: Удалить событие (ADMIN)
      tags:
        - Events
  /events/{id}/sessions:
    get:
      operationId: EventsController_getEventSessions
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: cursor
          required: false
          in: query
          description: Cursor for pagination. Pass the value from the "next" field of the previous response.
          schema:
            type: string
        - name: limit
          required: false
          in: query
          schema:
            minimum: 1
            maximum: 200
            default: 20
            type: number
        - name: startsAfter
          required: false
          in: query
          description: Return entities starting AFTER this moment (RFC3339)
          schema:
            format: date-time
            type: string
        - name: endsBefore
          required: false
          in: query
          description: Return entities starting BEFORE this moment (RFC3339)
          schema:
            format: date-time
            type: string
        - name: sortBy
          required: false
          in: query
          description: Field to sort by
          schema:
            default: startsAt
            enum:
              - createdAt
              - startsAt
            type: string
        - name: sortOrder
          required: false
          in: query
          description: Sort order
          schema:
            default: asc
            enum:
              - asc
              - desc
            type: string
        - name: minRemainingSeats
          required: false
          in: query
          description: Minimum remaining seats
          schema:
            minimum: 0
            type: number
        - name: labels.any
          required: false
          in: query
          description: Match ANY of the specified labels (OR)
          schema:
            type: array
            items:
              type: string
        - name: labels.all
          required: false
          in: query
          description: Match ALL of the specified labels (AND)
          schema:
            type: array
            items:
              type: string
        - name: labels.none
          required: false
          in: query
          description: Exclude sessions with any of these labels (NOT)
          schema:
            type: array
            items:
              type: string
        - name: attr.eq
          required: false
          in: query
          description: Equality filter by attribute keys, e.g. attr.eq[city]=istanbul
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.in
          required: false
          in: query
          description: In set filter by attribute keys, e.g. attr.in[level]=[beginner,intermediate]
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.gte
          required: false
          in: query
          description: Greater than or equal filter for numeric attributes
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.lte
          required: false
          in: query
          description: Less than or equal filter for numeric attributes
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.bool
          required: false
          in: query
          description: Boolean attribute filter
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.exists
          required: false
          in: query
          description: Check attribute key existence (true/false)
          schema:
            $ref: '#/components/schemas/Object'
      responses:
        '200':
          description: Сессии события
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponseDto'
      summary: Сессии события (возвращает eventId вместо полного события)
      tags:
        - Events
    post:
      operationId: EventsController_createEventSessions
      parameters:
        - name: id
          required: true
          in: path
          description: ID события
          schema:
            type: string
        - name: Idempotency-Key
          in: header
          description: Уникальный ключ идемпотентности запроса
          required: true
          schema:
            type: string
            minLength: 8
            maxLength: 128
      responses:
        '201':
          description: Сессии созданы
          content:
            application/json:
              schema:
                type: object
                required:
                  - items
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/SessionCompact'
      security:
        - adminAuth: []
        - bearer: []
      summary: Создать сессии для события (ADMIN)
      tags:
        - Events
  /sessions:
    get:
      operationId: SessionsController_findAll
      parameters:
        - name: cursor
          required: false
          in: query
          description: Cursor for pagination. Pass the value from the "next" field of the previous response.
          schema:
            type: string
        - name: limit
          required: false
          in: query
          schema:
            minimum: 1
            maximum: 200
            default: 20
            type: number
        - name: startsAfter
          required: false
          in: query
          description: Return entities starting AFTER this moment (RFC3339)
          schema:
            format: date-time
            type: string
        - name: endsBefore
          required: false
          in: query
          description: Return entities starting BEFORE this moment (RFC3339)
          schema:
            format: date-time
            type: string
        - name: eventId
          required: false
          in: query
          description: Filter by event ID
          schema:
            type: string
        - name: sortBy
          required: false
          in: query
          description: Field to sort by
          schema:
            enum:
              - createdAt
              - startsAt
            type: string
        - name: sortOrder
          required: false
          in: query
          schema:
            default: asc
            enum:
              - asc
              - desc
            type: string
        - name: labels.any
          required: false
          in: query
          description: Match ANY of the specified labels (OR)
          schema:
            type: array
            items:
              type: string
        - name: labels.all
          required: false
          in: query
          description: Match ALL of the specified labels (AND)
          schema:
            type: array
            items:
              type: string
        - name: labels.none
          required: false
          in: query
          description: Exclude sessions with any of these labels (NOT)
          schema:
            type: array
            items:
              type: string
        - name: attr.eq
          required: false
          in: query
          description: Equality filter by attribute keys
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.in
          required: false
          in: query
          description: In set filter by attribute keys
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.gte
          required: false
          in: query
          description: Greater than or equal filter for numeric attributes
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.lte
          required: false
          in: query
          description: Less than or equal filter for numeric attributes
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.bool
          required: false
          in: query
          description: Boolean attribute filter
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.exists
          required: false
          in: query
          description: Check attribute key existence
          schema:
            $ref: '#/components/schemas/Object'
        - name: minRemainingSeats
          required: false
          in: query
          description: Minimum remaining seats
          schema:
            minimum: 0
            type: number
        - name: onWaitlist
          required: false
          in: query
          description: Filter sessions where the current user is on the waitlist (requires authentication)
          schema:
            type: boolean
      responses:
        '200':
          description: Список сессий
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponseDto'
      summary: Поиск сессий
      tags:
        - Sessions
    patch:
      description: >-
        Позволяет обновить несколько сессий за один запрос. Каждая сессия в массиве должна содержать ID и поля для
        обновления.
      operationId: SessionsController_bulkUpdate
      parameters:
        - name: idempotency-key
          required: true
          in: header
          schema:
            type: string
        - name: Idempotency-Key
          in: header
          description: Уникальный ключ идемпотентности запроса
          required: true
          schema:
            type: string
            minLength: 8
            maxLength: 128
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                type: string
      responses:
        '200':
          description: Сессии успешно обновлены
          content:
            application/json:
              schema:
                type: object
                required:
                  - items
                  - updated
                  - failed
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Session'
                    description: Успешно обновлённые сессии
                  updated:
                    type: integer
                    description: Количество успешно обновлённых сессий
                  failed:
                    type: array
                    items:
                      type: object
                      required:
                        - id
                        - error
                      properties:
                        id:
                          type: string
                          description: ID сессии, которую не удалось обновить
                        error:
                          type: string
                          description: Описание ошибки
                    description: Список сессий, которые не удалось обновить
      security:
        - adminAuth: []
        - bearer: []
      summary: Массовое обновление сессий (ADMIN)
      tags:
        - Sessions
    delete:
      description: >-
        Позволяет удалить несколько сессий за один запрос. По умолчанию не позволяет удалять сессии с активными
        бронированиями.
      operationId: SessionsController_bulkDelete
      parameters:
        - name: idempotency-key
          required: true
          in: header
          schema:
            type: string
        - name: Idempotency-Key
          in: header
          description: Уникальный ключ идемпотентности запроса
          required: true
          schema:
            type: string
            minLength: 8
            maxLength: 128
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SessionBulkDeleteDto'
      responses:
        '200':
          description: Операция выполнена
          content:
            application/json:
              schema:
                type: object
                required:
                  - deleted
                  - failed
                properties:
                  deleted:
                    type: array
                    items:
                      type: string
                    description: ID успешно удалённых сессий
                  failed:
                    type: array
                    items:
                      type: object
                      required:
                        - id
                        - error
                      properties:
                        id:
                          type: string
                          description: ID сессии, которую не удалось удалить
                        error:
                          type: string
                          description: Причина неудачи
                    description: Список сессий, которые не удалось удалить
      security:
        - adminAuth: []
        - bearer: []
      summary: Массовое удаление сессий (ADMIN)
      tags:
        - Sessions
  /sessions/{id}:
    get:
      operationId: SessionsController_findOne
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Сессия
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionDto'
      summary: Получить сессию
      tags:
        - Sessions
    patch:
      operationId: SessionsController_update
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SessionUpdateDto'
      responses:
        '200':
          description: Обновлённая сессия
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionDto'
      security:
        - adminAuth: []
        - bearer: []
      summary: Обновить сессию
      tags:
        - Sessions
    delete:
      operationId: SessionsController_cancel
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Сессия отменена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SessionDto'
      security:
        - adminAuth: []
        - bearer: []
      summary: Отменить сессию (установить статус CANCELLED) (ADMIN)
      tags:
        - Sessions
  /sessions/{id}/book:
    post:
      operationId: SessionsController_createBookingHold
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: idempotency-key
          required: true
          in: header
          schema:
            type: string
        - name: Idempotency-Key
          in: header
          description: Ключ идемпотентности для безопасного повтора POST-запросов
          required: true
          schema:
            type: string
            minLength: 8
            maxLength: 128
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBookingDto'
      responses:
        '201':
          description: Холд создан
          headers:
            X-Hold-TTL:
              description: Время жизни холда в секундах
              schema:
                type: integer
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingDto'
      security:
        - bearer: []
      summary: Создать холд бронирования на сессию
      tags:
        - Sessions
  /sessions/{id}/book-deferred:
    post:
      description: >-
        Создаёт бронирование для событий с allowDeferredPayment=true. Бронирование сразу получает статус CONFIRMED, но с
        флагом isPaid=false. Оплата подтверждается позже администратором.
      operationId: SessionsController_createDeferredBooking
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: idempotency-key
          required: true
          in: header
          schema:
            type: string
        - name: Idempotency-Key
          in: header
          description: Ключ идемпотентности для безопасного повтора POST-запросов
          required: true
          schema:
            type: string
            minLength: 8
            maxLength: 128
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBookingDto'
      responses:
        '201':
          description: Бронирование создано (ожидает оплаты)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingDto'
        '400':
          description: Событие не поддерживает отложенную оплату
      security:
        - bearer: []
      summary: Создать бронирование с отложенной оплатой
      tags:
        - Sessions
  /bookings:
    get:
      operationId: BookingsController_findAll
      parameters:
        - name: clientId
          required: false
          in: query
          description: Filter by client ID (ADMIN only)
          schema:
            type: string
        - name: sessionId
          required: false
          in: query
          description: Filter by session ID
          schema:
            type: string
        - name: status
          required: false
          in: query
          description: Filter by booking status (can specify multiple comma-separated)
          schema:
            type: array
            items:
              type: string
              enum:
                - HOLD
                - CONFIRMED
                - CANCELLED
                - EXPIRED
        - name: bookingType
          required: false
          in: query
          description: Filter by booking type (ADMIN only)
          schema:
            default: all
            enum:
              - registered
              - guest
              - all
            type: string
        - name: includeUser
          required: false
          in: query
          description: Include user information in response (ADMIN only)
          schema:
            default: false
            type: boolean
        - name: includeSession
          required: false
          in: query
          description: Include session information in response
          schema:
            default: false
            type: boolean
        - name: includePaymentInfo
          required: false
          in: query
          description: Include payment information in response (ADMIN only)
          schema:
            default: false
            type: boolean
        - name: includeGuestContact
          required: false
          in: query
          description: Include guest contact details in response (ADMIN only)
          schema:
            default: false
            type: boolean
        - name: labels.any
          required: false
          in: query
          description: Match ANY of the specified session labels (OR)
          schema:
            type: array
            items:
              type: string
        - name: labels.all
          required: false
          in: query
          description: Match ALL of the specified session labels (AND)
          schema:
            type: array
            items:
              type: string
        - name: labels.none
          required: false
          in: query
          description: Exclude bookings with sessions having any of these labels (NOT)
          schema:
            type: array
            items:
              type: string
        - name: attr.eq
          required: false
          in: query
          description: Equality filter by session attribute keys
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.in
          required: false
          in: query
          description: In set filter by session attribute keys
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.gte
          required: false
          in: query
          description: Greater than or equal filter for numeric session attributes
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.lte
          required: false
          in: query
          description: Less than or equal filter for numeric session attributes
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.bool
          required: false
          in: query
          description: Boolean session attribute filter
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.exists
          required: false
          in: query
          description: Check session attribute key existence
          schema:
            $ref: '#/components/schemas/Object'
        - name: cursor
          required: false
          in: query
          description: Cursor for pagination
          schema:
            type: string
        - name: limit
          required: false
          in: query
          description: Limit elements per page
          schema:
            minimum: 1
            maximum: 200
            default: 20
            type: number
        - name: createdAfter
          required: false
          in: query
          description: Filter bookings created after this timestamp (RFC3339)
          schema:
            format: date-time
            type: string
        - name: createdBefore
          required: false
          in: query
          description: Filter bookings created before this timestamp (RFC3339)
          schema:
            format: date-time
            type: string
        - name: startsAfter
          required: false
          in: query
          description: Filter bookings where session starts after this timestamp (RFC3339)
          schema:
            format: date-time
            type: string
        - name: startsBefore
          required: false
          in: query
          description: Filter bookings where session starts before this timestamp (RFC3339)
          schema:
            format: date-time
            type: string
        - name: endsAfter
          required: false
          in: query
          description: Filter bookings where session ends after this timestamp (RFC3339)
          schema:
            format: date-time
            type: string
        - name: endsBefore
          required: false
          in: query
          description: Filter bookings where session ends before this timestamp (RFC3339)
          schema:
            format: date-time
            type: string
        - name: minQuantity
          required: false
          in: query
          description: Minimum number of seats in booking
          schema:
            type: number
        - name: maxQuantity
          required: false
          in: query
          description: Maximum number of seats in booking
          schema:
            type: number
        - name: minPrice
          required: false
          in: query
          description: Minimum total price in minor units (kopecks/cents)
          schema:
            type: number
        - name: maxPrice
          required: false
          in: query
          description: Maximum total price in minor units (kopecks/cents)
          schema:
            type: number
        - name: eventId
          required: false
          in: query
          description: Filter bookings by event ID
          schema:
            type: string
        - name: seasonTicketId
          required: false
          in: query
          description: Filter bookings paid with specific season ticket
          schema:
            type: string
        - name: createdBy
          required: false
          in: query
          description: Filter by admin who created the booking (ADMIN only)
          schema:
            type: string
        - name: q
          required: false
          in: query
          description: Search in guest contact info (phone, name, email) and user info
          schema:
            type: string
        - name: sortBy
          required: false
          in: query
          description: Field to sort by
          schema:
            default: createdAt
            enum:
              - createdAt
              - totalPrice
              - status
              - startsAt
            type: string
        - name: sortOrder
          required: false
          in: query
          description: Sort order
          schema:
            default: desc
            enum:
              - asc
              - desc
            type: string
      responses:
        '200':
          description: Список бронирований
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/Booking'
                  next:
                    type: string
                    nullable: true
        '401':
          description: Не авторизован
        '403':
          description: Доступ запрещен
      security:
        - bearer: []
      summary: Список бронирований (свои или ADMIN с расширенной фильтрацией)
      tags:
        - Bookings
  /bookings/{id}:
    get:
      operationId: BookingsController_findOne
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: includeSession
          required: false
          in: query
          description: Включить информацию о сессии в ответ
          schema:
            type: boolean
        - name: includeUser
          required: false
          in: query
          description: Включить информацию о пользователе в ответ (только ADMIN)
          schema:
            type: boolean
      responses:
        '200':
          description: Бронирование
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingExtendedDto'
        '401':
          description: Не авторизован
        '403':
          description: Доступ запрещен
        '404':
          description: Не найдено
      security:
        - bearer: []
      summary: Получить бронирование
      tags:
        - Bookings
    patch:
      operationId: BookingsController_updateBooking
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateBookingDto'
      responses:
        '200':
          description: Бронирование обновлено
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingExtendedDto'
        '400':
          description: Неверный запрос
        '401':
          description: Не авторизован
        '403':
          description: Доступ запрещен
        '404':
          description: Не найдено
        '409':
          description: Конфликт
      security:
        - bearer: []
        - adminAuth: []
      summary: Обновить бронирование (только ADMIN)
      tags:
        - Bookings
  /bookings/{id}/payment:
    post:
      operationId: BookingsController_createBookingPayment
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: idempotency-key
          required: true
          in: header
          schema:
            type: string
        - name: Idempotency-Key
          in: header
          description: Уникальный ключ идемпотентности запроса
          required: true
          schema:
            type: string
            minLength: 8
            maxLength: 128
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateBookingPaymentDto'
      responses:
        '201':
          description: Платёж инициирован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateBookingPaymentResponseDto'
        '401':
          description: Не авторизован
        '403':
          description: Доступ запрещен
        '404':
          description: Не найдено
        '409':
          description: Конфликт
      security:
        - bearer: []
      summary: Создать платёж для бронирования
      tags:
        - Bookings
  /bookings/{id}/cancel:
    post:
      operationId: BookingsController_cancelBooking
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Бронирование отменено
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingDto'
        '401':
          description: Не авторизован
        '403':
          description: Доступ запрещен
        '404':
          description: Не найдено
        '409':
          description: Конфликт
      security:
        - bearer: []
      summary: Отменить бронирование (своё для HOLD/CONFIRMED по политике, или ADMIN)
      tags:
        - Bookings
  /bookings/{id}/confirm:
    post:
      operationId: BookingsController_confirmBooking
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Бронирование подтверждено
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingDto'
        '401':
          description: Не авторизован
        '403':
          description: Доступ запрещен
        '404':
          description: Не найдено
        '409':
          description: Конфликт
      security:
        - bearer: []
        - adminAuth: []
      summary: Подтвердить бронирование (оффлайн-оплата, только ADMIN)
      tags:
        - Bookings
  /bookings/{id}/mark-paid:
    post:
      description: >-
        Используется для подтверждения оплаты бронирований с отложенной оплатой (isPaid=false). Устанавливает
        isPaid=true.
      operationId: BookingsController_markBookingAsPaid
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Оплата подтверждена
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BookingDto'
        '401':
          description: Не авторизован
        '403':
          description: Доступ запрещен
        '404':
          description: Не найдено
        '409':
          description: Бронирование уже оплачено
      security:
        - bearer: []
        - adminAuth: []
      summary: Отметить бронирование как оплаченное (только ADMIN)
      tags:
        - Bookings
  /payments:
    get:
      operationId: PaymentsController_findAll
      parameters:
        - name: cursor
          required: false
          in: query
          description: Курсор для пагинации. Передайте значение из поля "next" предыдущего ответа.
          schema:
            example: cm4a2b3c4d5e6f7g8h9i0j
            type: string
        - name: limit
          required: false
          in: query
          description: Количество элементов на странице
          schema:
            minimum: 1
            maximum: 200
            default: 20
            example: 20
            type: number
        - name: status
          required: false
          in: query
          description: Filter by payment status (can specify multiple comma-separated)
          schema:
            type: array
            items:
              type: string
              enum:
                - PENDING
                - SUCCEEDED
                - FAILED
                - CANCELLED
        - name: category
          required: false
          in: query
          description: Filter by payment category
          schema:
            enum:
              - session
              - seasonTicket
              - certificate
            type: string
        - name: createdAfter
          required: false
          in: query
          description: Return payments created AFTER this moment (RFC3339)
          schema:
            format: date-time
            type: string
        - name: createdBefore
          required: false
          in: query
          description: Return payments created BEFORE this moment (RFC3339)
          schema:
            format: date-time
            type: string
        - name: labels.any
          required: false
          in: query
          description: Match ANY of the specified labels (OR)
          schema:
            type: array
            items:
              type: string
        - name: labels.all
          required: false
          in: query
          description: Match ALL of the specified labels (AND)
          schema:
            type: array
            items:
              type: string
        - name: labels.none
          required: false
          in: query
          description: Exclude payments with any of these labels (NOT)
          schema:
            type: array
            items:
              type: string
        - name: attr.eq
          required: false
          in: query
          description: Equality filter by attribute keys
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.in
          required: false
          in: query
          description: In set filter by attribute keys
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.gte
          required: false
          in: query
          description: Greater than or equal filter for numeric attributes
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.lte
          required: false
          in: query
          description: Less than or equal filter for numeric attributes
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.bool
          required: false
          in: query
          description: Boolean attribute filter
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.exists
          required: false
          in: query
          description: Check attribute key existence
          schema:
            $ref: '#/components/schemas/Object'
        - name: sortBy
          required: false
          in: query
          description: Field to sort by
          schema:
            enum:
              - createdAt
              - price
              - status
            type: string
        - name: sortOrder
          required: false
          in: query
          description: Sort order
          schema:
            default: desc
            enum:
              - asc
              - desc
            type: string
      responses:
        '200':
          description: Список платежей пользователя
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponseDto'
      security:
        - bearer: []
      summary: Платежи текущего пользователя
      tags:
        - Payments
  /payments/{id}:
    get:
      operationId: PaymentsController_findOne
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Детали платежа
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentDto'
        '404':
          description: Платёж не найден
      security:
        - bearer: []
      summary: Детали платежа
      tags:
        - Payments
  /payments/{id}/refunds:
    post:
      operationId: PaymentsController_createRefund
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: idempotency-key
          required: true
          in: header
          schema:
            type: string
        - name: Idempotency-Key
          in: header
          description: Уникальный ключ идемпотентности запроса
          required: true
          schema:
            type: string
            minLength: 8
            maxLength: 128
      responses:
        '201':
          description: Возврат создан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RefundDto'
        '401':
          description: Не авторизован
        '403':
          description: Доступ запрещен
        '404':
          description: Платёж не найден
        '409':
          description: Конфликт
      security:
        - bearer: []
      summary: Создать возврат
      tags:
        - Payments
  /webhooks/payments/provider:
    post:
      operationId: PaymentWebhooksController_handleWebhook
      parameters:
        - name: x-signature
          required: true
          in: header
          schema:
            type: string
        - name: X-Signature
          in: header
          description: Подпись от провайдера
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK (идемпотентная обработка; дубликаты разрешены)
        '400':
          description: Неверная подпись или данные
      summary: Вебхук от платёжного провайдера
      tags:
        - Webhooks
  /webhooks/telegram/bot:
    post:
      description: >-
        Receives Telegram Bot API updates (payments).


        - On `pre_checkout_query`: verify booking hold & amount, then call Bot API `answerPreCheckoutQuery` within 10
        seconds.


        - On `successful_payment`: set Payment=SUCCEEDED and Booking=CONFIRMED.
            
      operationId: TelegramWebhookController_handleTelegramWebhook
      parameters:
        - name: x-telegram-bot-api-secret-token
          required: true
          in: header
          schema:
            type: string
        - name: X-Telegram-Bot-Api-Secret-Token
          in: header
          description: Secret token set via setWebhook to verify Telegram as the sender.
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TelegramWebhookDto'
      responses:
        '200':
          description: OK
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorDto'
        '401':
          description: Unauthorized (missing/invalid secret token)
        '500':
          description: Server error
      summary: Telegram Bot webhook for payments
      tags:
        - Webhooks
  /certificates/products:
    get:
      description: Возвращает список типов сертификатов, доступных для покупки, с ценами и деталями
      operationId: CertificatesController_getCertificateProducts
      parameters: []
      responses:
        '200':
          description: Продукты сертификатов
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CertificateProductsResponseDto'
      summary: Получить доступные продукты сертификатов
      tags:
        - Certificates
  /certificates/purchase:
    post:
      description: Клиент покупает сертификат и получает инструкции по оплате
      operationId: CertificatesController_purchaseCertificate
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PurchaseCertificateDto'
      responses:
        '201':
          description: Сертификат создан, оплата инициирована
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PurchaseCertificateResponseDto'
        '400':
          description: Неверный запрос
        '403':
          description: Только клиенты могут покупать
      security:
        - clientAuth: []
        - bearer: []
      summary: Купить сертификат
      tags:
        - Certificates
  /certificates/activate:
    post:
      description: Активировать сертификат и конвертировать в выгоду (Абонемент или Кэшбэк)
      operationId: CertificatesController_activateCertificate
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ActivateCertificateRequestDto'
      responses:
        '200':
          description: Сертификат активирован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CertificateActivationResponseDto'
        '404':
          description: Сертификат не найден
        '409':
          description: Сертификат уже активирован или истек
        '410':
          description: Сертификат истек
      security:
        - clientAuth: []
        - bearer: []
      summary: Активировать сертификат по коду
      tags:
        - Certificates
  /certificates/purchased:
    get:
      description: Получить список сертификатов, купленных текущим пользователем
      operationId: CertificatesController_findPurchased
      parameters:
        - name: cursor
          required: false
          in: query
          description: Курсор для пагинации. Передайте значение из поля "next" предыдущего ответа.
          schema:
            example: cm4a2b3c4d5e6f7g8h9i0j
            type: string
        - name: limit
          required: false
          in: query
          description: Количество элементов на странице
          schema:
            minimum: 1
            maximum: 200
            default: 20
            example: 20
            type: number
        - name: status
          required: false
          in: query
          description: Фильтр по статусу
          schema:
            enum:
              - PENDING_ACTIVATION
              - ACTIVATED
              - EXPIRED
            type: string
      responses:
        '200':
          description: Купленные сертификаты
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListCertificatesResponseDto'
      security:
        - bearer: []
      summary: Список купленных сертификатов
      tags:
        - Certificates
  /certificates/activated:
    get:
      description: Получить список сертификатов, активированных текущим пользователем
      operationId: CertificatesController_findActivated
      parameters:
        - name: cursor
          required: false
          in: query
          description: Курсор для пагинации. Передайте значение из поля "next" предыдущего ответа.
          schema:
            example: cm4a2b3c4d5e6f7g8h9i0j
            type: string
        - name: limit
          required: false
          in: query
          description: Количество элементов на странице
          schema:
            minimum: 1
            maximum: 200
            default: 20
            example: 20
            type: number
      responses:
        '200':
          description: Активированные сертификаты
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ListCertificatesResponseDto'
      security:
        - bearer: []
      summary: Список активированных сертификатов
      tags:
        - Certificates
  /certificates/by-code/{code}:
    get:
      description: Проверить, валиден ли сертификат и можно ли его активировать
      operationId: CertificatesController_checkByCode
      parameters:
        - name: code
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Детали сертификата
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CheckCertificateResponseDto'
        '404':
          description: Сертификат не найден
      security:
        - bearer: []
      summary: Проверить сертификат по коду
      tags:
        - Certificates
  /certificates/{id}:
    get:
      description: Получить детали сертификата (только владелец или админ)
      operationId: CertificatesController_findById
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Детали сертификата
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CertificateDto'
        '403':
          description: Доступ запрещен
        '404':
          description: Сертификат не найден
      security:
        - bearer: []
      summary: Получить сертификат по ID
      tags:
        - Certificates
  /season-ticket-plans:
    post:
      operationId: SeasonTicketPlansController_createPlan
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSeasonTicketPlanDto'
      responses:
        '201':
          description: План создан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SeasonTicketPlanDto'
      security:
        - adminAuth: []
        - bearer: []
      summary: Создать план абонемента (ADMIN)
      tags:
        - Season Tickets
    get:
      operationId: SeasonTicketPlansController_findAllPlans
      parameters:
        - name: eventIds
          required: false
          in: query
          description: Filter plans applicable to ANY of these event IDs (OR)
          schema:
            example:
              - event1
              - event2
            type: array
            items:
              type: string
        - name: sessionId
          required: false
          in: query
          description: Filter plans applicable to this session ID
          schema:
            example: session123
            type: string
        - name: cursor
          required: false
          in: query
          description: Cursor for pagination
          schema:
            type: string
        - name: limit
          required: false
          in: query
          description: Limit elements per page
          schema:
            minimum: 1
            maximum: 200
            default: 20
            type: number
      responses:
        '200':
          description: Список планов
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponseDto'
      summary: Список планов абонементов
      tags:
        - Season Tickets
  /season-ticket-plans/{id}:
    get:
      operationId: SeasonTicketPlansController_findPlanById
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Детали плана
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SeasonTicketPlanDto'
        '404':
          description: План не найден
      summary: Детали плана абонемента
      tags:
        - Season Tickets
    patch:
      operationId: SeasonTicketPlansController_updatePlan
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSeasonTicketPlanDto'
      responses:
        '200':
          description: План обновлён
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SeasonTicketPlanDto'
      security:
        - adminAuth: []
        - bearer: []
      summary: Обновить план абонемента
      tags:
        - Season Tickets
    delete:
      operationId: SeasonTicketPlansController_deletePlan
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '204':
          description: Удалён или деактивирован
      security:
        - adminAuth: []
        - bearer: []
      summary: Удалить (или деактивировать) план
      tags:
        - Season Tickets
  /season-ticket-plans/{id}/purchase:
    post:
      operationId: SeasonTicketPlansController_createPurchase
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: idempotency-key
          required: true
          in: header
          schema:
            type: string
        - name: Idempotency-Key
          in: header
          description: Уникальный ключ идемпотентности запроса
          required: true
          schema:
            type: string
            minLength: 8
            maxLength: 128
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PurchaseSeasonTicketDto'
      responses:
        '201':
          description: Платёж для покупки абонемента создан
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentDto'
        '401':
          description: Не авторизован
        '403':
          description: Доступ запрещен
        '404':
          description: План не найден
        '409':
          description: Конфликт
      security:
        - bearer: []
      summary: Купить абонемент (clientId из токена)
      tags:
        - Season Tickets
  /season-ticket-plans/{id}/applicable-events:
    get:
      operationId: SeasonTicketPlansController_getApplicableEvents
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: cursor
          required: false
          in: query
          description: Курсор для пагинации. Передайте значение из поля "next" предыдущего ответа.
          schema:
            example: cm4a2b3c4d5e6f7g8h9i0j
            type: string
        - name: limit
          required: false
          in: query
          description: Количество элементов на странице
          schema:
            minimum: 1
            maximum: 200
            default: 20
            example: 20
            type: number
      responses:
        '200':
          description: Список применимых событий
        '404':
          description: План не найден
      summary: События, применимые к этому плану абонемента
      tags:
        - Season Tickets
  /season-tickets:
    get:
      operationId: SeasonTicketsController_findAllTickets
      parameters:
        - name: sessionId
          required: false
          in: query
          description: Filter tickets applicable to this session ID
          schema:
            example: session123
            type: string
        - name: eventId
          required: false
          in: query
          description: Filter tickets applicable to this event ID
          schema:
            example: event123
            type: string
        - name: status
          required: false
          in: query
          description: Filter by ticket status (can specify multiple)
          schema:
            example:
              - ACTIVE
            type: array
            items:
              type: string
              enum:
                - ACTIVE
                - EXPIRED
                - CANCELLED
        - name: hasRemainingPasses
          required: false
          in: query
          description: Filter tickets with remaining passes
          schema:
            example: true
            type: boolean
        - name: clientId
          required: false
          in: query
          description: Filter by client ID (admin only)
          schema:
            example: client123
            type: string
        - name: cursor
          required: false
          in: query
          description: Cursor for pagination
          schema:
            type: string
        - name: limit
          required: false
          in: query
          description: Limit elements per page
          schema:
            minimum: 1
            maximum: 200
            default: 20
            type: number
      responses:
        '200':
          description: Список абонементов
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponseDto'
      security:
        - bearer: []
      summary: Список абонементов (свои или ADMIN)
      tags:
        - Season Tickets
  /season-tickets/{id}:
    get:
      operationId: SeasonTicketsController_findById
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Абонемент
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SeasonTicketDto'
      security:
        - bearer: []
      summary: Получить абонемент по ID
      tags:
        - Season Tickets
  /season-tickets/{id}/cancel:
    post:
      operationId: SeasonTicketsController_cancelSeasonTicket
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Отменён
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SeasonTicketDto'
      security:
        - bearer: []
      summary: Отменить абонемент (пропорциональный возврат)
      tags:
        - Season Tickets
  /clients/{id}/season-tickets:
    get:
      operationId: ClientSeasonTicketsController_findClientTickets
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: cursor
          required: false
          in: query
          description: Курсор для пагинации. Передайте значение из поля "next" предыдущего ответа.
          schema:
            example: cm4a2b3c4d5e6f7g8h9i0j
            type: string
        - name: limit
          required: false
          in: query
          description: Количество элементов на странице
          schema:
            minimum: 1
            maximum: 200
            default: 20
            example: 20
            type: number
      responses:
        '200':
          description: Абонементы клиента
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponseDto'
      security:
        - bearer: []
      summary: Абонементы клиента
      tags:
        - Clients
        - Season Tickets
  /sessions/{id}/waitlist:
    post:
      operationId: WaitlistController_joinWaitlist
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: idempotency-key
          required: true
          in: header
          schema:
            type: string
        - name: Idempotency-Key
          in: header
          description: Ключ идемпотентности для безопасного повтора POST запросов
          required: true
          schema:
            type: string
            minLength: 8
            maxLength: 128
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JoinWaitlistDto'
      responses:
        '201':
          description: Добавлен в лист ожидания
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WaitlistEntryDto'
        '409':
          description: Сессия не заполнена или недоступна для листа ожидания
      security:
        - bearer: []
      summary: Встать в лист ожидания на заполненную сессию
      tags:
        - Waitlist
    delete:
      operationId: WaitlistController_leaveWaitlist
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '204':
          description: Удален или отсутствовал
      security:
        - bearer: []
      summary: Покинуть лист ожидания
      tags:
        - Waitlist
    get:
      operationId: WaitlistController_getWaitlistEntries
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: cursor
          required: false
          in: query
          description: Курсор для пагинации. Передайте значение из поля "next" предыдущего ответа.
          schema:
            example: cm4a2b3c4d5e6f7g8h9i0j
            type: string
        - name: limit
          required: false
          in: query
          description: Количество элементов на странице
          schema:
            minimum: 1
            maximum: 200
            default: 20
            example: 20
            type: number
      responses:
        '200':
          description: Записи
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponseDto'
      security:
        - adminAuth: []
        - bearer: []
      summary: Список записей листа ожидания
      tags:
        - Waitlist
  /sessions/{id}/subscriptions:
    get:
      deprecated: true
      operationId: SubscriptionsController_getSubscriptions
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: cursor
          required: false
          in: query
          description: Курсор для пагинации. Передайте значение из поля "next" предыдущего ответа.
          schema:
            example: cm4a2b3c4d5e6f7g8h9i0j
            type: string
        - name: limit
          required: false
          in: query
          description: Количество элементов на странице
          schema:
            minimum: 1
            maximum: 200
            default: 20
            example: 20
            type: number
      responses:
        '200':
          description: Записи
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponseDto'
      security:
        - adminAuth: []
        - bearer: []
      summary: Алиас /sessions/{id}/waitlist
      tags:
        - Waitlist
  /users/{id}/waitlist:
    get:
      operationId: UserWaitlistController_getUserWaitlistedSessions
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
        - name: cursor
          required: false
          in: query
          description: Курсор для пагинации. Передайте значение из поля "next" предыдущего ответа.
          schema:
            example: cm4a2b3c4d5e6f7g8h9i0j
            type: string
        - name: limit
          required: false
          in: query
          description: Количество элементов на странице
          schema:
            minimum: 1
            maximum: 200
            default: 20
            example: 20
            type: number
      responses:
        '200':
          description: Сессии, где пользователь в листе ожидания
      security:
        - bearer: []
      summary: Сессии пользователя в листе ожидания
      tags:
        - Waitlist
        - Users
  /admin/payments:
    get:
      operationId: AdminController_getPayments
      parameters:
        - name: cursor
          required: false
          in: query
          description: Курсор для пагинации. Передайте значение из поля "next" предыдущего ответа.
          schema:
            example: cm4a2b3c4d5e6f7g8h9i0j
            type: string
        - name: limit
          required: false
          in: query
          description: Количество элементов на странице
          schema:
            minimum: 1
            maximum: 200
            default: 20
            example: 20
            type: number
        - name: status
          required: false
          in: query
          description: Filter by payment status (can specify multiple comma-separated)
          schema:
            type: array
            items:
              type: string
              enum:
                - PENDING
                - SUCCEEDED
                - FAILED
                - CANCELLED
        - name: category
          required: false
          in: query
          description: Filter by payment category
          schema:
            enum:
              - session
              - seasonTicket
              - certificate
            type: string
        - name: createdAfter
          required: false
          in: query
          description: Return payments created AFTER this moment (RFC3339)
          schema:
            format: date-time
            type: string
        - name: createdBefore
          required: false
          in: query
          description: Return payments created BEFORE this moment (RFC3339)
          schema:
            format: date-time
            type: string
        - name: labels.any
          required: false
          in: query
          description: Match ANY of the specified labels (OR)
          schema:
            type: array
            items:
              type: string
        - name: labels.all
          required: false
          in: query
          description: Match ALL of the specified labels (AND)
          schema:
            type: array
            items:
              type: string
        - name: labels.none
          required: false
          in: query
          description: Exclude payments with any of these labels (NOT)
          schema:
            type: array
            items:
              type: string
        - name: attr.eq
          required: false
          in: query
          description: Equality filter by attribute keys
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.in
          required: false
          in: query
          description: In set filter by attribute keys
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.gte
          required: false
          in: query
          description: Greater than or equal filter for numeric attributes
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.lte
          required: false
          in: query
          description: Less than or equal filter for numeric attributes
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.bool
          required: false
          in: query
          description: Boolean attribute filter
          schema:
            $ref: '#/components/schemas/Object'
        - name: attr.exists
          required: false
          in: query
          description: Check attribute key existence
          schema:
            $ref: '#/components/schemas/Object'
        - name: sortBy
          required: false
          in: query
          description: Field to sort by
          schema:
            enum:
              - createdAt
              - price
              - status
            type: string
        - name: sortOrder
          required: false
          in: query
          description: Sort order
          schema:
            default: desc
            enum:
              - asc
              - desc
            type: string
        - name: clientId
          required: false
          in: query
          description: Filter by client ID (admin only)
          schema:
            type: string
      responses:
        '200':
          description: Список всех платежей
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponseDto'
      security:
        - adminAuth: []
        - bearer: []
      summary: Получить все платежи
      tags:
        - Admin
  /admin/audit-logs:
    get:
      operationId: AdminController_getAuditLogs
      parameters:
        - name: cursor
          required: false
          in: query
          description: Курсор для пагинации. Передайте значение из поля "next" предыдущего ответа.
          schema:
            example: cm4a2b3c4d5e6f7g8h9i0j
            type: string
        - name: limit
          required: false
          in: query
          description: Количество элементов на странице
          schema:
            minimum: 1
            maximum: 200
            default: 20
            example: 20
            type: number
        - name: filter.action
          required: false
          in: query
          schema:
            type: string
        - name: filter.entityType
          required: false
          in: query
          schema:
            type: string
        - name: filter.entityId
          required: false
          in: query
          schema:
            type: string
        - name: filter.adminId
          required: false
          in: query
          schema:
            type: string
        - name: filter.dateFrom
          required: false
          in: query
          schema:
            type: string
        - name: filter.dateTo
          required: false
          in: query
          schema:
            type: string
      responses:
        '200':
          description: Записи аудита
          content:
            application/json:
              schema:
                type: object
                properties:
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/AuditLog'
                  next:
                    type: string
                    nullable: true
      security:
        - adminAuth: []
        - bearer: []
      summary: Журнал аудита
      tags:
        - Admin
  /admin/upload:
    post:
      operationId: AdminController_uploadFile
      parameters: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                file:
                  type: string
                  format: binary
                  description: Файл для загрузки (изображения и др.)
              required:
                - file
      responses:
        '201':
          description: Файл успешно загружен
          content:
            application/json:
              schema:
                type: object
                properties:
                  url:
                    type: string
                    description: Публичный URL для доступа к файлу
                  objectName:
                    type: string
                    description: Имя объекта в MinIO
      security:
        - adminAuth: []
        - bearer: []
      summary: Загрузить файл в MinIO
      tags:
        - Admin
  /admin/jobs/run/booking-expiry:
    post:
      operationId: JobsController_runBookingExpiryJob
      parameters: []
      responses:
        '200':
          description: Задача истечения бронирований завершена
          content:
            application/json:
              schema:
                type: object
                properties:
                  expired:
                    type: number
      security:
        - adminAuth: []
        - bearer: []
      summary: Запустить задачу истечения бронирований вручную
      tags:
        - Jobs
  /admin/jobs/run/season-ticket-expiry:
    post:
      operationId: JobsController_runSeasonTicketExpiryJob
      parameters: []
      responses:
        '200':
          description: Задача истечения абонементов завершена
          content:
            application/json:
              schema:
                type: object
                properties:
                  expired:
                    type: number
      security:
        - adminAuth: []
        - bearer: []
      summary: Запустить задачу истечения абонементов вручную
      tags:
        - Jobs
  /images:
    post:
      operationId: ImagesController_uploadImages
      parameters: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                files:
                  type: array
                  items:
                    type: string
                    format: binary
                  description: Файлы изображений (макс. 10 файлов, 10МБ каждый)
                tags:
                  type: array
                  items:
                    type: string
                  description: Теги для категоризации
                  nullable: true
              required:
                - files
      responses:
        '201':
          description: Изображения успешно загружены
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ImageDto'
      security:
        - adminAuth: []
        - bearer: []
      summary: Загрузить изображения
      tags:
        - Images
    get:
      operationId: ImagesController_findAll
      parameters:
        - name: cursor
          required: false
          in: query
          description: Курсор для пагинации. Передайте значение из поля "next" предыдущего ответа.
          schema:
            example: cm4a2b3c4d5e6f7g8h9i0j
            type: string
        - name: limit
          required: false
          in: query
          description: Количество элементов на странице
          schema:
            minimum: 1
            maximum: 200
            default: 20
            example: 20
            type: number
        - name: q
          required: false
          in: query
          description: Search by original name or object name
          schema:
            type: string
        - name: mimetype
          required: false
          in: query
          description: Filter by MIME type (e.g., image/jpeg)
          schema:
            type: string
        - name: tags.any
          required: false
          in: query
          description: Has any of these tags
          schema:
            type: array
            items:
              type: string
        - name: tags.all
          required: false
          in: query
          description: Has all of these tags
          schema:
            type: array
            items:
              type: string
        - name: tags.none
          required: false
          in: query
          description: Has none of these tags
          schema:
            type: array
            items:
              type: string
        - name: minSize
          required: false
          in: query
          description: Minimum file size in bytes
          schema:
            type: number
        - name: maxSize
          required: false
          in: query
          description: Maximum file size in bytes
          schema:
            type: number
        - name: uploadedAfter
          required: false
          in: query
          description: Return images uploaded AFTER this moment (RFC3339)
          schema:
            format: date-time
            type: string
        - name: uploadedBefore
          required: false
          in: query
          description: Return images uploaded BEFORE this moment (RFC3339)
          schema:
            format: date-time
            type: string
        - name: uploadedByAdminId
          required: false
          in: query
          description: Filter by uploader admin ID
          schema:
            type: string
      responses:
        '200':
          description: Список изображений
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedResponseDto'
      summary: Список изображений с фильтрацией
      tags:
        - Images
  /images/batch:
    post:
      operationId: ImagesController_batchUpload
      parameters: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                files:
                  type: array
                  items:
                    type: string
                    format: binary
                  description: Файлы изображений (макс. 10 файлов, 10МБ каждый)
                tags:
                  type: array
                  items:
                    type: string
                  description: Теги для категоризации
                  nullable: true
              required:
                - files
      responses:
        '201':
          description: Изображения успешно загружены
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ImageDto'
      security:
        - adminAuth: []
        - bearer: []
      summary: Пакетная загрузка изображений (алиас POST /images)
      tags:
        - Images
  /images/{id}:
    get:
      operationId: ImagesController_findOne
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '200':
          description: Изображение
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImageDto'
      summary: Получить изображение по ID
      tags:
        - Images
    patch:
      operationId: ImagesController_update
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ImageUpdateDto'
      responses:
        '200':
          description: Изображение обновлено
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ImageDto'
      security:
        - adminAuth: []
        - bearer: []
      summary: Обновить метаданные изображения
      tags:
        - Images
    delete:
      description: Удаляет изображение из MinIO и базы данных
      operationId: ImagesController_delete
      parameters:
        - name: id
          required: true
          in: path
          schema:
            type: string
      responses:
        '204':
          description: Изображение успешно удалено
      security:
        - adminAuth: []
        - bearer: []
      summary: Удалить изображение
      tags:
        - Images
  /images/batch/delete:
    delete:
      description: Удаляет несколько изображений из MinIO и базы данных
      operationId: ImagesController_batchDelete
      parameters: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BatchDeleteDto'
      responses:
        '204':
          description: Изображения успешно удалены
      security:
        - adminAuth: []
        - bearer: []
      summary: Пакетное удаление изображений
      tags:
        - Images
  /static/images/{objectName}:
    get:
      operationId: StaticController_serveImage
      parameters:
        - name: objectName
          required: true
          in: path
          description: Имя объекта в MinIO
          schema:
            type: string
      responses:
        '200':
          description: Файл изображения
          content:
            image/jpeg:
              schema:
                type: string
                format: binary
            image/png:
              schema:
                type: string
                format: binary
            image/gif:
              schema:
                type: string
                format: binary
            image/webp:
              schema:
                type: string
                format: binary
        '404':
          description: Изображение не найдено
      summary: Отдать файл изображения
      tags:
        - Static
info:
  title: Surf Booking Telegram Web App API
  description: |
    API для сервиса бронирования и оплаты тренировок по сёрфингу, скейтсёрфингу и вейксёрфингу.

    ## Аутентификация

    API поддерживает две схемы аутентификации:

    ### Для клиентов (Telegram)
    - Используется `POST /auth/client/telegram` с initData из Telegram Web App
    - Возвращает JWT токены для авторизации запросов
    - Защищённые эндпоинты помечены `clientAuth`

    ### Для администраторов
    - Используется `POST /auth/admin/login` с email/password
    - Возвращает JWT токены для авторизации запросов
    - Защищённые эндпоинты помечены `adminAuth`

    ## Пагинация

    API использует cursor-based пагинацию:
    - `cursor` - курсор для получения следующей страницы
    - `limit` - количество элементов на странице (по умолчанию 20, максимум 200)
    - Ответ содержит `next` - курсор для следующей страницы (null если это последняя)

    ## Идемпотентность

    Эндпоинты создания ресурсов требуют заголовок `Idempotency-Key` для безопасного повтора запросов.
  version: v0.4.0
  contact: {}
tags: []
servers:
  - url: https://urgently-intimate-tody.cloudpub.ru
    description: Current Environment
components:
  securitySchemes:
    bearer:
      scheme: bearer
      bearerFormat: JWT
      type: http
      description: JWT токен авторизации
    adminAuth:
      scheme: bearer
      bearerFormat: JWT
      type: http
      description: Требуется роль ADMIN. Используйте POST /auth/admin/login для получения токена.
    clientAuth:
      scheme: bearer
      bearerFormat: JWT
      type: http
      description: Требуется роль CLIENT. Используйте POST /auth/client/telegram для получения токена.
  schemas:
    TelegramLoginDto:
      type: object
      properties:
        initData:
          type: string
          description: Данные инициализации Telegram Web App
          example: >-
            query_id=AAHdF6IQAAAAAN0XohDhrOrc&user=%7B%22id%22%3A1234567890%2C%22first_name%22%3A%22John%22%7D&auth_date=1234567890&hash=abc123...
      required:
        - initData
    ClientDto:
      type: object
      properties:
        id:
          type: string
        telegramId:
          type: string
          description: Telegram user ID
        telegramChatId:
          type: object
          nullable: true
        username:
          type: object
          nullable: true
        phone:
          type: object
          nullable: true
        firstName:
          type: object
          nullable: true
        lastName:
          type: object
          nullable: true
        photoUrl:
          type: object
          nullable: true
          description: URL of profile photo
        dateOfBirth:
          type: object
          nullable: true
          format: date-time
          description: Date of birth
        isActive:
          type: boolean
        personalDataConsent:
          type: boolean
          description: Consent for personal data processing
        privacyPolicyConsent:
          type: boolean
          description: Consent for privacy policy
        safetyRulesConsent:
          type: boolean
          description: Consent for safety rules
        consentsAcceptedAt:
          type: object
          nullable: true
          format: date-time
          description: Timestamp when all required consents were accepted
        isProfileComplete:
          type: boolean
          description: Indicates if the profile is complete (has phone, name, and all consents)
        createdAt:
          type: string
          format: date-time
      required:
        - id
        - telegramId
        - isActive
        - personalDataConsent
        - privacyPolicyConsent
        - safetyRulesConsent
        - isProfileComplete
        - createdAt
    ClientAuthResponseDto:
      type: object
      properties:
        accessToken:
          type: string
          description: JWT токен доступа
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        refreshToken:
          type: string
          description: Токен обновления
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        client:
          description: Данные клиента
          allOf:
            - $ref: '#/components/schemas/ClientDto'
      required:
        - accessToken
        - refreshToken
        - client
    ErrorDto:
      type: object
      properties:
        code:
          type: string
          enum:
            - AMOUNT_MISMATCH
            - DUPLICATE_PAYMENT
            - HOLD_EXPIRED
            - NO_SEATS
            - PROVIDER_UNAVAILABLE
            - INVALID_CREDENTIALS
            - USER_EXISTS
            - WEAK_PASSWORD
            - INVALID_EMAIL
          description: Error code
        message:
          type: string
          description: Human-readable error message
        details:
          type: object
          nullable: true
          description: Доп. сведения об ошибке
      required:
        - code
        - message
    AdminLoginDto:
      type: object
      properties:
        email:
          type: string
          description: Email администратора
          example: admin@example.com
        password:
          type: string
          format: password
          minLength: 6
          description: Пароль администратора
          example: AdminPassword123
      required:
        - email
        - password
    AdminDto:
      type: object
      properties:
        id:
          type: string
        email:
          type: string
        firstName:
          type: string
        lastName:
          type: string
        phone:
          type: object
          nullable: true
        department:
          type: object
          nullable: true
        isActive:
          type: boolean
        createdAt:
          type: string
          format: date-time
      required:
        - id
        - email
        - firstName
        - lastName
        - isActive
        - createdAt
    AdminAuthResponseDto:
      type: object
      properties:
        accessToken:
          type: string
          description: JWT токен доступа
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        refreshToken:
          type: string
          description: Токен обновления
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        admin:
          description: Данные администратора
          allOf:
            - $ref: '#/components/schemas/AdminDto'
      required:
        - accessToken
        - refreshToken
        - admin
    RefreshTokenDto:
      type: object
      properties:
        refreshToken:
          type: string
          description: Токен обновления
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
      required:
        - refreshToken
    RefreshTokenResponseDto:
      type: object
      properties:
        accessToken:
          type: string
          description: Новый JWT токен доступа
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        refreshToken:
          type: string
          description: Новый токен обновления
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
      required:
        - accessToken
        - refreshToken
    MeResponseDto:
      type: object
      properties:
        type:
          type: string
          enum:
            - CLIENT
            - ADMIN
          description: Тип пользователя
          example: CLIENT
        client:
          description: Данные клиента (присутствует если type=CLIENT)
          allOf:
            - $ref: '#/components/schemas/ClientDto'
        admin:
          description: Данные администратора (присутствует если type=ADMIN)
          allOf:
            - $ref: '#/components/schemas/AdminDto'
      required:
        - type
    PaginatedResponseDto:
      type: object
      properties:
        items:
          description: Массив элементов текущей страницы
          type: array
          items:
            type: string
        next:
          type: string
          nullable: true
          description: Курсор для получения следующей страницы. null если это последняя страница.
          example: cm4a2b3c4d5e6f7g8h9i0j
      required:
        - items
    PriceDto:
      type: object
      properties:
        currency:
          type: string
          description: ISO-4217 currency code
          example: KZT
        amountMinor:
          type: number
          description: Amount in minor units (tiyn/cents)
          example: 129900
      required:
        - currency
        - amountMinor
    CashbackHistoryItemDto:
      type: object
      properties:
        id:
          type: string
        type:
          type: string
          enum:
            - EARN
            - REDEEM
            - ADJUST
        amount:
          $ref: '#/components/schemas/PriceDto'
        createdAt:
          type: string
          format: date-time
        note:
          type: object
          nullable: true
      required:
        - id
        - type
        - amount
        - createdAt
    CashbackWalletDto:
      type: object
      properties:
        balance:
          $ref: '#/components/schemas/PriceDto'
        history:
          type: array
          items:
            $ref: '#/components/schemas/CashbackHistoryItemDto'
      required:
        - balance
    CompleteProfileDto:
      type: object
      properties:
        firstName:
          type: string
          description: First name (required)
          example: Иван
        lastName:
          type: string
          description: Last name (required)
          example: Иванов
        phone:
          type: string
          description: Phone number (required)
          example: '+79991234567'
        personalDataConsent:
          type: boolean
          description: Consent for personal data processing (must be true)
          example: true
        privacyPolicyConsent:
          type: boolean
          description: Consent for privacy policy (must be true)
          example: true
        safetyRulesConsent:
          type: boolean
          description: Consent for safety rules (must be true)
          example: true
      required:
        - firstName
        - lastName
        - phone
        - personalDataConsent
        - privacyPolicyConsent
        - safetyRulesConsent
    CashbackEarnRateDto:
      type: object
      properties:
        product:
          type: string
          enum:
            - single
            - certificate
            - seasonTicket
        rate:
          type: number
          minimum: 0
          maximum: 1
          description: Earn rate (0.05 = 5%)
      required:
        - product
        - rate
    CashbackRulesDto:
      type: object
      properties:
        earnRates:
          type: array
          items:
            $ref: '#/components/schemas/CashbackEarnRateDto'
        maxRedeemRate:
          type: number
          minimum: 0
          maximum: 1
          description: Maximum portion of payment that can be covered by cashback
      required:
        - earnRates
        - maxRedeemRate
    CashbackSettingsDto:
      type: object
      properties:
        id:
          type: string
        product:
          type: string
          enum:
            - single
            - certificate
            - seasonTicket
        rate:
          type: number
          minimum: 0
          maximum: 1
          description: Cashback rate (0.05 = 5%)
        maxRedeemRate:
          type: object
          nullable: true
          minimum: 0
          maximum: 1
          description: Maximum redeem rate (only for one product)
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - id
        - product
        - rate
        - createdAt
        - updatedAt
    UpdateCashbackSettingsDto:
      type: object
      properties:
        rate:
          type: number
          minimum: 0
          maximum: 1
          description: Cashback rate (0.05 = 5%)
        maxRedeemRate:
          type: object
          nullable: true
          minimum: 0
          maximum: 1
          description: Maximum redeem rate (only for single product)
      required:
        - rate
    CreateAdminDto:
      type: object
      properties:
        email:
          type: string
          example: admin@example.com
        password:
          type: string
          minLength: 6
          example: SecurePassword123
        firstName:
          type: string
          example: John
        lastName:
          type: string
          example: Doe
        phone:
          type: string
        department:
          type: string
      required:
        - email
        - password
        - firstName
        - lastName
    AdminUpdateDto:
      type: object
      properties:
        firstName:
          type: string
        lastName:
          type: string
        phone:
          type: object
          nullable: true
        department:
          type: object
          nullable: true
    ChangePasswordDto:
      type: object
      properties:
        currentPassword:
          type: string
          minLength: 6
        newPassword:
          type: string
          minLength: 6
      required:
        - currentPassword
        - newPassword
    Object:
      type: object
      properties: {}
    EventDescriptionDto:
      type: object
      properties:
        heading:
          type: string
        body:
          type: string
      required:
        - heading
        - body
    TicketPriceDto:
      type: object
      properties:
        price:
          $ref: '#/components/schemas/PriceDto'
        description:
          type: object
          nullable: true
      required:
        - price
    EventTicketDto:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        prepayment:
          $ref: '#/components/schemas/TicketPriceDto'
        full:
          $ref: '#/components/schemas/TicketPriceDto'
      required:
        - id
        - name
        - prepayment
        - full
    EventDto:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        description:
          nullable: true
          type: array
          items:
            $ref: '#/components/schemas/EventDescriptionDto'
        location:
          type: object
          nullable: true
        capacity:
          type: object
          minimum: 0
          nullable: true
          description: Вместимость по умолчанию для сессий этого события. Может быть переопределена в конкретной сессии.
        tickets:
          type: array
          items:
            $ref: '#/components/schemas/EventTicketDto'
        createdAt:
          type: string
          format: date-time
        labels:
          description: Event labels
          type: array
          items:
            type: string
        attributes:
          type: object
          additionalProperties: true
          description: Event attributes
        images:
          description: Array of image URLs
          type: array
          items:
            type: string
        allowDeferredPayment:
          type: boolean
          description: Allow deferred (offline/cash) payment for this event
          default: false
      required:
        - id
        - title
        - tickets
        - createdAt
    SessionBulkDeleteDto:
      type: object
      properties:
        ids:
          minItems: 1
          maxItems: 100
          description: List of session IDs to delete
          type: array
          items:
            type: string
        force:
          type: boolean
          default: false
          description: Force delete even when there are active bookings
      required:
        - ids
    SessionDto:
      type: object
      properties:
        id:
          type: string
        event:
          $ref: '#/components/schemas/EventDto'
        startsAt:
          type: string
          format: date-time
        endsAt:
          type: object
          format: date-time
          nullable: true
        capacity:
          type: object
          minimum: 0
          nullable: true
          description: Вместимость сессии. Если не указана, используется capacity из события.
        remainingSeats:
          type: number
          minimum: 0
        hasBooking:
          type: boolean
          description: У текущего пользователя есть активная бронь
        onWaitlist:
          type: boolean
          description: Текущий пользователь в листе ожидания
        status:
          type: string
          enum:
            - SCHEDULED
            - CANCELLED
        labels:
          nullable: true
          description: Session labels (override/extend event labels)
          type: array
          items:
            type: string
        attributes:
          type: object
          additionalProperties: true
          description: Session attributes
        effectiveLabels:
          readOnly: true
          description: Denormalized labels (Event ⊕ Session)
          type: array
          items:
            type: string
        effectiveAttributes:
          type: object
          readOnly: true
          additionalProperties: true
          description: Denormalized attributes (Event ⊕ Session)
        createdAt:
          type: string
          format: date-time
      required:
        - id
        - event
        - startsAt
        - remainingSeats
        - status
        - createdAt
    SessionUpdateDto:
      type: object
      properties:
        startsAt:
          type: string
          format: date-time
        endsAt:
          type: object
          format: date-time
          nullable: true
        capacity:
          type: object
          minimum: 0
          nullable: true
          description: Вместимость сессии. Если не указана, используется capacity из события.
        labels:
          description: Session labels
          type: array
          items:
            type: string
        attributes:
          type: object
          additionalProperties: true
          description: Session attributes
    GuestContactDto:
      type: object
      properties:
        phone:
          type: string
          description: Guest phone number (required)
          pattern: ^\+?[0-9]{7,15}$
        firstName:
          type: string
          description: Guest first name
          maxLength: 128
        lastName:
          type: string
          description: Guest last name
          maxLength: 128
        email:
          type: string
          description: Guest email
          format: email
        note:
          type: string
          description: Additional notes about the guest
          maxLength: 500
      required:
        - phone
    CreateBookingDto:
      type: object
      properties:
        quantity:
          type: number
          minimum: 1
          description: Количество мест для бронирования
        clientId:
          type: object
          nullable: true
          description: >-
            ID клиента для бронирования (только ADMIN). Если не указан и нет guestContact, бронирование создается как
            гостевое.
        guestContact:
          nullable: true
          description: >-
            Контактные данные гостя без регистрации (только ADMIN). Используется для создания гостевых бронирований.
            Нельзя использовать одновременно с clientId.
          allOf:
            - $ref: '#/components/schemas/GuestContactDto'
        status:
          type: string
          enum:
            - HOLD
            - CONFIRMED
          default: HOLD
          description: >-
            Начальный статус брони (только ADMIN). CONFIRMED используется для немедленного подтверждения при офлайн
            оплате. Обычные пользователи всегда создают статус HOLD.
        ticketId:
          type: object
          nullable: true
          description: ID билета для расчета цены (только ADMIN)
        notes:
          type: object
          nullable: true
          maxLength: 1000
          description: Внутренние заметки администратора (только ADMIN)
      required:
        - quantity
    BookingHoldDto:
      type: object
      properties:
        expiresAt:
          type: string
          format: date-time
      required:
        - expiresAt
    BookingDto:
      type: object
      properties:
        id:
          type: string
        sessionId:
          type: string
        clientId:
          type: object
          nullable: true
          description: ID клиента. Может быть null для гостевых бронирований, созданных админом
        quantity:
          type: number
          minimum: 1
        status:
          type: string
          enum:
            - HOLD
            - CONFIRMED
            - CANCELLED
            - EXPIRED
        hold:
          nullable: true
          allOf:
            - $ref: '#/components/schemas/BookingHoldDto'
        totalPrice:
          $ref: '#/components/schemas/PriceDto'
        guestContact:
          nullable: true
          description: Контактные данные гостя для бронирований без регистрации (создается админом)
          allOf:
            - $ref: '#/components/schemas/GuestContactDto'
        notes:
          type: object
          nullable: true
          description: Заметки администратора о бронировании
        createdAt:
          type: string
          format: date-time
        createdByAdminId:
          type: object
          nullable: true
          description: ID администратора, создавшего бронирование
        isPaid:
          type: boolean
          description: Статус оплаты. False для отложенных платежей, ожидающих подтверждения.
          default: true
      required:
        - id
        - sessionId
        - quantity
        - status
        - totalPrice
        - createdAt
        - isPaid
    PaymentInfoDto:
      type: object
      properties:
        method:
          type: string
          enum:
            - card
            - certificate
            - pass
            - cashback
            - composite
          description: Метод оплаты
        paymentId:
          type: object
          nullable: true
          description: ID платежа (если применимо)
        certificateId:
          type: object
          nullable: true
          description: ID использованного сертификата (если применимо)
        seasonTicketId:
          type: object
          nullable: true
          description: ID использованного абонемента (если применимо)
      required:
        - method
    BookingExtendedDto:
      type: object
      properties:
        id:
          type: string
        sessionId:
          type: string
        clientId:
          type: object
          nullable: true
          description: ID клиента. Может быть null для гостевых бронирований, созданных админом
        quantity:
          type: number
          minimum: 1
        status:
          type: string
          enum:
            - HOLD
            - CONFIRMED
            - CANCELLED
            - EXPIRED
        hold:
          nullable: true
          allOf:
            - $ref: '#/components/schemas/BookingHoldDto'
        totalPrice:
          $ref: '#/components/schemas/PriceDto'
        guestContact:
          nullable: true
          description: Контактные данные гостя для бронирований без регистрации (создается админом)
          allOf:
            - $ref: '#/components/schemas/GuestContactDto'
        notes:
          type: object
          nullable: true
          description: Заметки администратора о бронировании
        createdAt:
          type: string
          format: date-time
        createdByAdminId:
          type: object
          nullable: true
          description: ID администратора, создавшего бронирование
        isPaid:
          type: boolean
          description: Статус оплаты. False для отложенных платежей, ожидающих подтверждения.
          default: true
        client:
          description: Информация о пользователе (доступно при запросе с правами ADMIN)
          allOf:
            - $ref: '#/components/schemas/ClientDto'
        session:
          description: Информация о сессии (включается при использовании параметра includeSession)
          allOf:
            - $ref: '#/components/schemas/SessionDto'
        paymentInfo:
          nullable: true
          description: Информация об оплате (доступно при запросе с правами ADMIN)
          allOf:
            - $ref: '#/components/schemas/PaymentInfoDto'
      required:
        - id
        - sessionId
        - quantity
        - status
        - totalPrice
        - createdAt
        - isPaid
    CreateBookingPaymentDto:
      type: object
      properties:
        paymentMethods:
          oneOf:
            - type: array
              items:
                $ref: '#/components/schemas/PaymentMethodRequestDto'
            - $ref: '#/components/schemas/PaymentMethodRequestDto'
            - $ref: '#/components/schemas/CompositePaymentMethodRequestDto'
          description: Payment methods - accepts array (new format), single method, or composite object (backward compatibility)
      required:
        - paymentMethods
    CreateBookingPaymentResponseDto:
      type: object
      properties:
        id:
          type: string
        bookingId:
          type: string
        amount:
          $ref: '#/components/schemas/PriceDto'
        status:
          type: string
          enum:
            - PENDING
            - SUCCEEDED
            - FAILED
            - CANCELLED
        createdAt:
          type: string
          format: date-time
        provider:
          type: string
          enum:
            - telegram
            - stripe
            - yookassa
            - cloudpayments
            - other
        providerPaymentId:
          type: object
          nullable: true
        providerChargeId:
          type: object
          nullable: true
        nextAction:
          oneOf:
            - $ref: '#/components/schemas/PaymentNextActionOpenInvoice'
            - $ref: '#/components/schemas/PaymentNextActionRedirect'
            - $ref: '#/components/schemas/PaymentNextActionNone'
          discriminator:
            propertyName: type
            mapping:
              openInvoice: '#/components/schemas/PaymentNextActionOpenInvoice'
              redirect: '#/components/schemas/PaymentNextActionRedirect'
              none: '#/components/schemas/PaymentNextActionNone'
      required:
        - id
        - bookingId
        - amount
        - status
        - createdAt
        - provider
        - nextAction
    UpdateBookingDto:
      type: object
      properties:
        quantity:
          type: number
          minimum: 1
          description: Новое количество мест
        guestContact:
          description: Обновленные контактные данные гостя
          allOf:
            - $ref: '#/components/schemas/GuestContactDto'
        notes:
          type: string
          maxLength: 1000
          description: Обновленные заметки администратора
    PaymentNextActionOpenInvoiceDto:
      type: object
      properties:
        type:
          type: string
          enum:
            - openInvoice
        slugOrUrl:
          type: string
      required:
        - type
        - slugOrUrl
    PaymentNextActionRedirectDto:
      type: object
      properties:
        type:
          type: string
          enum:
            - redirect
        url:
          type: string
          format: uri
      required:
        - type
        - url
    PaymentNextActionNoneDto:
      type: object
      properties:
        type:
          type: string
          enum:
            - none
      required:
        - type
    PaymentDto:
      type: object
      properties:
        id:
          type: string
        bookingId:
          type: object
          nullable: true
          description: Null for standalone payments like season ticket purchases
        amount:
          $ref: '#/components/schemas/PriceDto'
        status:
          type: string
          enum:
            - PENDING
            - SUCCEEDED
            - FAILED
            - CANCELLED
        createdAt:
          type: string
          format: date-time
        provider:
          type: string
          enum:
            - telegram
            - stripe
            - yookassa
            - cloudpayments
            - other
        providerPaymentId:
          type: object
          nullable: true
        providerChargeId:
          type: object
          nullable: true
        nextAction:
          oneOf:
            - $ref: '#/components/schemas/PaymentNextActionOpenInvoiceDto'
            - $ref: '#/components/schemas/PaymentNextActionRedirectDto'
            - $ref: '#/components/schemas/PaymentNextActionNoneDto'
          discriminator:
            propertyName: type
            mapping:
              openInvoice: '#/components/schemas/PaymentNextActionOpenInvoiceDto'
              redirect: '#/components/schemas/PaymentNextActionRedirectDto'
              none: '#/components/schemas/PaymentNextActionNoneDto'
      required:
        - id
        - amount
        - status
        - createdAt
        - provider
        - nextAction
    RefundDto:
      type: object
      properties:
        id:
          type: string
        paymentId:
          type: string
        amount:
          $ref: '#/components/schemas/PriceDto'
        createdAt:
          type: string
      required:
        - id
        - paymentId
        - amount
        - createdAt
    TelegramUserDto:
      type: object
      properties:
        id:
          type: number
        is_bot:
          type: boolean
        first_name:
          type: string
        last_name:
          type: string
        username:
          type: string
        language_code:
          type: string
        is_premium:
          type: boolean
      required:
        - id
        - first_name
    TelegramChatDto:
      type: object
      properties:
        id:
          type: number
        type:
          type: string
        first_name:
          type: string
        last_name:
          type: string
        username:
          type: string
      required:
        - id
    TelegramSuccessfulPaymentDto:
      type: object
      properties:
        telegram_payment_charge_id:
          type: string
        provider_payment_charge_id:
          type: string
        invoice_payload:
          type: string
        shipping_option_id:
          type: string
        currency:
          type: string
        total_amount:
          type: number
      required:
        - telegram_payment_charge_id
        - provider_payment_charge_id
        - invoice_payload
        - currency
        - total_amount
    TelegramMessageDto:
      type: object
      properties:
        message_id:
          type: number
        from:
          $ref: '#/components/schemas/TelegramUserDto'
        chat:
          $ref: '#/components/schemas/TelegramChatDto'
        date:
          type: number
        successful_payment:
          $ref: '#/components/schemas/TelegramSuccessfulPaymentDto'
      required:
        - message_id
        - from
        - chat
        - date
    OrderInfoDto:
      type: object
      properties:
        name:
          type: string
        email:
          type: string
        phone_number:
          type: string
    TelegramPreCheckoutQueryDto:
      type: object
      properties:
        id:
          type: string
        from:
          $ref: '#/components/schemas/TelegramUserDto'
        currency:
          type: string
        total_amount:
          type: number
        invoice_payload:
          type: string
        shipping_option_id:
          type: string
        order_info:
          $ref: '#/components/schemas/OrderInfoDto'
      required:
        - id
        - from
        - currency
        - total_amount
        - invoice_payload
    TelegramWebhookDto:
      type: object
      properties:
        update_id:
          type: number
        message:
          $ref: '#/components/schemas/TelegramMessageDto'
        pre_checkout_query:
          $ref: '#/components/schemas/TelegramPreCheckoutQueryDto'
      required:
        - update_id
    CertificateProductsResponseDto:
      type: object
      properties:
        items:
          type: array
          items:
            oneOf:
              - $ref: '#/components/schemas/CertificateProductPassesDto'
              - $ref: '#/components/schemas/CertificateProductDenominationDto'
      required:
        - items
    PurchaseCertificateDto:
      type: object
      properties:
        type:
          type: string
          enum:
            - passes
            - denomination
        amount:
          description: Required for denomination type
          allOf:
            - $ref: '#/components/schemas/PriceDto'
        paymentMethods:
          oneOf:
            - type: array
              items:
                $ref: '#/components/schemas/PaymentMethodRequestDto'
            - $ref: '#/components/schemas/PaymentMethodRequestDto'
            - $ref: '#/components/schemas/CompositePaymentMethodRequestDto'
          description: Payment methods - accepts array (new format), single method, or composite object (backward compatibility)
      required:
        - type
        - paymentMethods
    ClientBriefDto:
      type: object
      properties:
        id:
          type: string
        firstName:
          type: object
        lastName:
          type: object
      required:
        - id
    CertificateDto:
      type: object
      properties:
        id:
          type: string
        code:
          type: string
          description: Activation code - only visible to purchaser or admin
        type:
          type: string
          enum:
            - denomination
            - passes
        status:
          type: string
          enum:
            - PENDING_ACTIVATION
            - ACTIVATED
            - EXPIRED
        data:
          oneOf:
            - type: object
              properties:
                amount:
                  $ref: '#/components/schemas/PriceDto'
            - type: object
              properties:
                passes:
                  type: integer
        purchasedBy:
          $ref: '#/components/schemas/ClientBriefDto'
        activatedBy:
          $ref: '#/components/schemas/ClientBriefDto'
        activatedAt:
          type: object
          format: date-time
        expiresAt:
          type: object
          format: date-time
        createdAt:
          type: string
          format: date-time
      required:
        - id
        - type
        - status
        - data
        - createdAt
    PurchaseCertificateResponseDto:
      type: object
      properties:
        certificate:
          $ref: '#/components/schemas/CertificateDto'
        payment:
          type: object
      required:
        - certificate
        - payment
    ActivateCertificateRequestDto:
      type: object
      properties:
        code:
          type: string
          description: Unique activation code
      required:
        - code
    CertificateActivationResponseDto:
      type: object
      properties:
        certificate:
          $ref: '#/components/schemas/CertificateDto'
        result:
          oneOf:
            - $ref: '#/components/schemas/CertificateActivationResultSeasonTicketDto'
            - $ref: '#/components/schemas/CertificateActivationResultCashbackDto'
      required:
        - certificate
        - result
    ListCertificatesResponseDto:
      type: object
      properties:
        items:
          type: array
          items:
            $ref: '#/components/schemas/CertificateDto'
        next:
          type: object
          description: Cursor for pagination
      required:
        - items
    CheckCertificateResponseDto:
      type: object
      properties:
        code:
          type: string
        type:
          type: string
          enum:
            - denomination
            - passes
        data:
          oneOf:
            - type: object
              properties:
                amount:
                  $ref: '#/components/schemas/PriceDto'
            - type: object
              properties:
                passes:
                  type: integer
        status:
          type: string
          enum:
            - PENDING_ACTIVATION
            - ACTIVATED
            - EXPIRED
        expiresAt:
          type: object
          format: date-time
        canActivate:
          type: boolean
          description: Whether current user can activate this certificate
        reason:
          type: string
          description: Reason why cannot activate (if canActivate is false)
      required:
        - code
        - type
        - data
        - status
        - canActivate
    EventFilterLabelsDto:
      type: object
      properties:
        any:
          description: Match ANY of these labels (OR)
          type: array
          items:
            type: string
        all:
          description: Match ALL of these labels (AND)
          type: array
          items:
            type: string
        none:
          description: Exclude events with any of these labels (NOT)
          type: array
          items:
            type: string
    EventFilterAttributesDto:
      type: object
      properties:
        eq:
          type: object
          description: Equality filters for attributes
        in:
          type: object
          description: In-set filters for attributes
        gte:
          type: object
          description: Greater-than-or-equal filters for numeric attributes
        lte:
          type: object
          description: Less-than-or-equal filters for numeric attributes
        bool:
          type: object
          description: Boolean filters for attributes
        exists:
          type: object
          description: Check existence of attribute keys
    EventFilterDto:
      type: object
      properties:
        labels:
          $ref: '#/components/schemas/EventFilterLabelsDto'
        attributes:
          $ref: '#/components/schemas/EventFilterAttributesDto'
    CreateSeasonTicketPlanDto:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
          nullable: true
        passes:
          type: number
          minimum: 1
        price:
          $ref: '#/components/schemas/PriceDto'
        expiresIn:
          type: number
          description: Days until expiration
          minimum: 1
        matchMode:
          type: string
          enum:
            - IDS_ONLY
            - FILTER_ONLY
            - ANY
            - ALL
          default: ALL
          description: Mode for matching events
        eventIds:
          nullable: true
          description: Explicit list of event IDs (optional)
          type: array
          items:
            type: string
        eventFilter:
          nullable: true
          description: Flexible event matching filters (optional)
          allOf:
            - $ref: '#/components/schemas/EventFilterDto'
      required:
        - name
        - passes
        - price
        - expiresIn
    SeasonTicketPlanDto:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
          nullable: true
        passes:
          type: number
        price:
          $ref: '#/components/schemas/PriceDto'
        expiresIn:
          type: number
          description: Days until expiration
        matchMode:
          type: string
          enum:
            - IDS_ONLY
            - FILTER_ONLY
            - ANY
            - ALL
          default: ALL
        eventIds:
          nullable: true
          type: array
          items:
            type: string
        eventFilter:
          nullable: true
          allOf:
            - $ref: '#/components/schemas/EventFilterDto'
      required:
        - id
        - name
        - passes
        - price
        - expiresIn
        - matchMode
    UpdateSeasonTicketPlanDto:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
          nullable: true
        passes:
          type: number
          minimum: 1
        price:
          $ref: '#/components/schemas/PriceDto'
        expiresIn:
          type: number
          description: Days until expiration
          minimum: 1
        matchMode:
          type: string
          enum:
            - IDS_ONLY
            - FILTER_ONLY
            - ANY
            - ALL
          description: Mode for matching events
        eventIds:
          nullable: true
          description: Explicit list of event IDs (optional)
          type: array
          items:
            type: string
        eventFilter:
          nullable: true
          description: Flexible event matching filters (optional)
          allOf:
            - $ref: '#/components/schemas/EventFilterDto'
    PurchaseSeasonTicketDto:
      type: object
      properties:
        paymentMethods:
          oneOf:
            - type: array
              items:
                $ref: '#/components/schemas/PaymentMethodRequestDto'
            - $ref: '#/components/schemas/PaymentMethodRequestDto'
            - $ref: '#/components/schemas/CompositePaymentMethodRequestDto'
          description: Payment methods - accepts array (new format), single method, or composite object (backward compatibility)
      required:
        - paymentMethods
    SeasonTicketDto:
      type: object
      properties:
        id:
          type: string
        plan:
          $ref: '#/components/schemas/SeasonTicketPlanDto'
        clientId:
          type: string
        paymentId:
          type: string
        status:
          type: string
          enum:
            - ACTIVE
            - EXPIRED
            - CANCELLED
        remainingPasses:
          type: number
        validUntil:
          type: string
          format: date-time
          description: Expiration date of the season ticket
      required:
        - id
        - plan
        - clientId
        - status
        - remainingPasses
        - validUntil
    JoinWaitlistDto:
      type: object
      properties:
        idempotencyKey:
          type: string
    WaitlistEntryDto:
      type: object
      properties:
        id:
          type: string
        sessionId:
          type: string
        clientId:
          type: string
        position:
          type: number
          minimum: 1
        createdAt:
          type: string
          format: date-time
      required:
        - id
        - sessionId
        - clientId
        - createdAt
    ImageUploaderDto:
      type: object
      properties:
        id:
          type: string
        firstName:
          type: object
          nullable: true
        lastName:
          type: object
          nullable: true
      required:
        - id
    ImageDto:
      type: object
      properties:
        id:
          type: string
        url:
          type: string
          description: Public URL to access the image (computed from objectName, not stored in DB)
        objectName:
          type: string
          description: MinIO object name (source of truth for URL generation)
        originalName:
          type: string
          description: Original filename
        mimetype:
          type: string
          description: MIME type (e.g., image/jpeg)
        size:
          type: number
          description: File size in bytes
        tags:
          description: Tags for categorization
          type: array
          items:
            type: string
        uploader:
          nullable: true
          allOf:
            - $ref: '#/components/schemas/ImageUploaderDto'
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
      required:
        - id
        - url
        - objectName
        - originalName
        - mimetype
        - size
        - tags
        - createdAt
        - updatedAt
    ImageUpdateDto:
      type: object
      properties:
        tags:
          description: Tags for categorization
          type: array
          items:
            type: string
    BatchDeleteDto:
      type: object
      properties:
        ids:
          description: Array of image IDs to delete
          type: array
          items:
            type: string
      required:
        - ids
